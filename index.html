<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>English Checker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  #drop-area {
    border: 2px dashed #ccc;
    padding: 20px;
    text-align: center;
    color: #888;
    margin-bottom: 10px;
  }
  #drop-area.dragover {
    border-color: #000;
    background-color: #f0f0f0;
  }
  textarea {
    width: 100%;
    height: 200px;
    margin-top: 10px;
  }
  button {
    margin: 10px 5px;
  }
  #result {
    white-space: pre-wrap;
    margin-top: 20px;
  }
  .error {
    background-color: #fdd;
  }
  .suggestion {
    background-color: #dfd;
  }
</style>
</head>
<body>

<h1>English Text Checker</h1>

<div id="drop-area">
  Drag & Drop or Paste Text Here
</div>
<textarea id="text-input" placeholder="Paste your text here..."></textarea>

<br/>

<input type="file" id="file-upload" accept=".txt,.docx" />

<br/>

<button id="check-btn">Check English</button>
<button id="apply-btn" disabled>Apply Fixes</button>
<button id="download-btn" disabled>Download Corrected Text</button>

<div id="result"></div>

<!-- Include Mammoth.js for .docx parsing -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>

<script>
const dropArea = document.getElementById('drop-area');
const textInput = document.getElementById('text-input');
const fileInput = document.getElementById('file-upload');
const checkBtn = document.getElementById('check-btn');
const applyBtn = document.getElementById('apply-btn');
const downloadBtn = document.getElementById('download-btn');
const resultDiv = document.getElementById('result');

let originalText = '';
let analyzedText = ''; // Will hold text with error highlights

// Drag & Drop handlers
dropArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropArea.classList.add('dragover');
});
dropArea.addEventListener('dragleave', (e) => {
  e.preventDefault();
  dropArea.classList.remove('dragover');
});
dropArea.addEventListener('drop', (e) => {
  e.preventDefault();
  dropArea.classList.remove('dragover');
  const files = e.dataTransfer.files;
  handleFiles(files);
});

// Handle file upload
fileInput.addEventListener('change', () => {
  handleFiles(fileInput.files);
});

// Handle pasted text
dropArea.addEventListener('paste', (e) => {
  e.preventDefault();
  const text = e.clipboardData.getData('text');
  textInput.value += text;
});

// Process files
function handleFiles(files) {
  if (files.length === 0) return;
  const file = files[0];
  const reader = new FileReader();
  if (file.name.endsWith('.txt')) {
    reader.onload = () => {
      textInput.value = reader.result;
    };
    reader.readAsText(file);
  } else if (file.name.endsWith('.docx')) {
    reader.onload = (e) => {
      mammoth.convertToHtml({buffer: e.target.result})
        .then(function(result) {
          // Extract plain text from HTML
          const tempDiv = document.createElement('div');
          tempDiv.innerHTML = result.value;
          textInput.value = tempDiv.innerText;
        })
        .catch(function(err) {
          alert('Error reading DOCX file.');
        });
    };
    reader.readAsArrayBuffer(file);
  } else {
    alert('Unsupported file type.');
  }
}

// Dummy grammar check function (replace with real API or logic)
function checkGrammar(text) {
  // For demo: highlight 'bad' as error, 'good' as suggestion
  const errors = [];
  const patternError = /\b(bad)\b/gi;
  const patternSuggest = /\b(good)\b/gi;

  let newText = text;
  let offset = 0;

  // Highlight errors in red
  newText = newText.replace(patternError, (match, p1, offsetPos) => {
    errors.push({index: offsetPos + offset, length: match.length, type: 'error', message: 'Replace "bad"'});
    return `<span class="error">${match}</span>`;
  });
  // Highlight suggestions in green
  newText = newText.replace(patternSuggest, (match, p1, offsetPos) => {
    errors.push({index: offsetPos + offset, length: match.length, type: 'suggestion', message: 'Replace "good"'});
    return `<span class="suggestion">${match}</span>`;
  });

  return {text: newText, errors: errors};
}

// Show analyzed text with highlights
function displayResult() {
  const text = textInput.value;
  const result = checkGrammar(text);
  analyzedText = result.text;
  resultDiv.innerHTML = result.text;
  if (result.errors.length > 0) {
    applyBtn.disabled = false;
    downloadBtn.disabled = false;
  } else {
    applyBtn.disabled = true;
    downloadBtn.disabled = true;
  }
}

// Check button
document.getElementById('check-btn').addEventListener('click', () => {
  originalText = textInput.value;
  displayResult();
});

// Apply fixes (simple replacements)
document.getElementById('apply-btn').addEventListener('click', () => {
  // For demo, just replace 'bad' with 'good'
  let fixedText = originalText.replace(/\b(bad)\b/gi, 'good');
  textInput.value = fixedText;
  displayResult();
});

// Download corrected text
downloadBtn.addEventListener('click', () => {
  const blob = new Blob([textInput.value], {type: 'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'corrected.txt';
  a.click();
  URL.revokeObjectURL(url);
});

</script>

</body>
</html>
